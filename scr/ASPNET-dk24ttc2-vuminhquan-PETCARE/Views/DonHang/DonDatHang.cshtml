@model IEnumerable<WebsiteThuCungBento.Models.DONDATHANG>

@{
    ViewBag.Title = "Quản lý đơn hàng";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-6">
            <h3 class="mb-2 fw-bold">
                <i class="fa-solid fa-shopping-cart text-primary me-2"></i>
                Quản Lý Đơn Đặt Hàng
            </h3>
            <p class="text-muted mb-0">Danh sách tất cả đơn hàng trong hệ thống</p>
        </div>
        <div class="col-md-6 text-md-end">
            <button class="btn btn-outline-primary me-2" onclick="window.print()">
                <i class="fa-solid fa-print me-2"></i>
                In báo cáo
            </button>
            <button class="btn btn-primary" onclick="location.reload()">
                <i class="fa-solid fa-rotate me-2"></i>
                Làm mới
            </button>
        </div>
    </div>

    <!-- Statistics -->
    <div class="row g-3 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stat-card bg-primary-subtle">
                <div class="stat-icon bg-primary">
                    <i class="fa-solid fa-receipt"></i>
                </div>
                <div class="stat-info">
                    <h3 class="mb-0">@Model.Count()</h3>
                    <p class="mb-0">Tổng đơn hàng</p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stat-card bg-success-subtle">
                <div class="stat-icon bg-success">
                    <i class="fa-solid fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 class="mb-0">@Model.Count(x => x.NGAYGIAO.HasValue)</h3>
                    <p class="mb-0">Đã giao</p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stat-card bg-warning-subtle">
                <div class="stat-icon bg-warning">
                    <i class="fa-solid fa-clock"></i>
                </div>
                <div class="stat-info">
                    <h3 class="mb-0">@Model.Count(x => !x.NGAYGIAO.HasValue)</h3>
                    <p class="mb-0">Chưa giao</p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stat-card bg-info-subtle">
                <div class="stat-icon bg-info">
                    <i class="fa-solid fa-dollar-sign"></i>
                </div>
                <div class="stat-info">
                    <h3 class="mb-0">@string.Format("{0:0,0}", Model.Sum(x => x.TONGTIEN))đ</h3>
                    <p class="mb-0">Tổng doanh thu</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="input-group">
                <span class="input-group-text bg-white">
                    <i class="fa-solid fa-search"></i>
                </span>
                <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm theo mã đơn, tên khách hàng...">
            </div>
        </div>
        <div class="col-md-4">
            <select class="form-select" id="statusFilter">
                <option value="">Tất cả đơn hàng</option>
                <option value="delivered">Đã giao</option>
                <option value="pending">Chưa giao</option>
                <option value="cod">Thanh toán COD</option>
            </select>
        </div>
    </div>

    <!-- Orders Table -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="p-3">Mã ĐH</th>
                                    <th class="p-3">Khách hàng</th>
                                    <th class="p-3">Ngày đặt</th>
                                    <th class="p-3">Ngày giao</th>
                                    <th class="p-3">Trạng thái</th>
                                    <th class="p-3">Thanh toán</th>
                                    <th class="p-3 text-end">Tổng tiền</th>
                                    <th class="p-3 text-center">Chi tiết</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.OrderByDescending(x => x.NGAYDAT))
                                {
                                    <tr class="order-row" 
                                        data-status="@(item.NGAYGIAO.HasValue ? "delivered" : "pending")"
                                        data-payment="@(item.DATHANHTOAN == true ? "cod" : "transfer")">
                                        <td class="p-3">
                                            <strong class="order-id">#@item.MADH</strong>
                                        </td>
                                        <td class="p-3">
                                            <div class="customer-name">
                                                <strong>@item.KHACHHANG.HOTENKH</strong>
                                            </div>
                                            <small class="text-muted">ID: @item.MAKH</small>
                                        </td>
                                        <td class="p-3">
                                            <div>
                                                <i class="fa-solid fa-calendar text-muted me-2"></i>
                                                @item.NGAYDAT.ToString("dd/MM/yyyy")
                                            </div>
                                            <small class="text-muted">@item.NGAYDAT.ToString("HH:mm")</small>
                                        </td>
                                        <td class="p-3">
                                            @if (item.NGAYGIAO.HasValue)
                                            {
                                                <div>
                                                    <i class="fa-solid fa-truck text-success me-2"></i>
                                                    @item.NGAYGIAO.Value.ToString("dd/MM/yyyy")
                                                </div>
                                            }
                                            else
                                            {
                                                <span class="text-muted">
                                                    <i class="fa-solid fa-clock me-2"></i>
                                                    Chưa giao
                                                </span>
                                            }
                                        </td>
                                        <td class="p-3">
                                            @if (item.NGAYGIAO.HasValue)
                                            {
                                                <span class="badge bg-success">
                                                    <i class="fa-solid fa-check me-1"></i>
                                                    Đã giao
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-warning">
                                                    <i class="fa-solid fa-clock me-1"></i>
                                                    Đang xử lý
                                                </span>
                                            }
                                        </td>
                                        <td class="p-3">
                                            @if (item.DATHANHTOAN == true)
                                            {
                                                <span class="badge bg-primary">
                                                    <i class="fa-solid fa-money-bill me-1"></i>
                                                    COD
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-info">
                                                    <i class="fa-solid fa-credit-card me-1"></i>
                                                    Chuyển khoản
                                                </span>
                                            }
                                        </td>
                                        <td class="p-3 text-end">
                                            <strong class="text-primary fs-6">
                                                @string.Format("{0:0,0}", item.TONGTIEN) đ
                                            </strong>
                                        </td>
                                        <td class="p-3 text-center">
                                            <a href="@Url.Action("ChiTietDonHang", "DonHang", new { id = item.MADH })" 
                                               class="btn btn-sm btn-outline-primary"
                                               title="Xem chi tiết">
                                                <i class="fa-solid fa-eye me-1"></i>
                                                Chi tiết
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stat-card {
        padding: 1.5rem;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .stat-info h3 {
        font-size: 1.75rem;
        font-weight: 700;
    }

    .stat-info p {
        color: #64748b;
        font-size: 0.9rem;
    }

    .table th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        color: #64748b;
    }

    .table tbody tr {
        transition: all 0.2s ease;
    }

    .table tbody tr:hover {
        background-color: #f8fafc;
    }

    .bg-primary-subtle {
        background-color: rgba(13, 110, 253, 0.1);
    }

    .bg-success-subtle {
        background-color: rgba(25, 135, 84, 0.1);
    }

    .bg-warning-subtle {
        background-color: rgba(255, 193, 7, 0.1);
    }

    .bg-info-subtle {
        background-color: rgba(13, 202, 240, 0.1);
    }

    @@media print {
        .btn, .input-group, .form-select {
            display: none !important;
        }
    }
</style>

<script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('.order-row');
        
        rows.forEach(row => {
            const orderId = row.querySelector('.order-id').textContent.toLowerCase();
            const customerName = row.querySelector('.customer-name').textContent.toLowerCase();
            
            if (orderId.includes(searchTerm) || customerName.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });

    // Status filter
    document.getElementById('statusFilter').addEventListener('change', function() {
        const filterValue = this.value;
        const rows = document.querySelectorAll('.order-row');
        
        rows.forEach(row => {
            if (!filterValue) {
                row.style.display = '';
                return;
            }
            
            const status = row.getAttribute('data-status');
            const payment = row.getAttribute('data-payment');
            
            if (filterValue === 'delivered' && status === 'delivered') {
                row.style.display = '';
            } else if (filterValue === 'pending' && status === 'pending') {
                row.style.display = '';
            } else if (filterValue === 'cod' && payment === 'cod') {
                row.style.display = '';
            } else if (filterValue) {
                row.style.display = 'none';
            }
        });
    });
</script>
